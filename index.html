<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>ç§Ÿé‡‘è©¦ç®—å·¥å…·</title>
  <style>
    body, html {
      height: 100%;
      margin: 0;
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      background: #f5f5f5;
    }

    #container {
      background: white;
      padding: 15px 55px;
      border-radius: 8px;
      box-shadow: 0 0 12px rgb(0 0 0 / 0.1);
      max-width: 900px;
      width: 100%;
      box-sizing: border-box;
      position: relative;
    }

    h2 {
      text-align: center;
      margin-bottom: 20px;
    }

    form {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
    }

    .form-row {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin: 5px 0;
      width: 350px;
    }

    label {
      width: 120px;
      font-weight: bold;
      text-align: left;
      margin-right: 15px;
      user-select: none;
      white-space: nowrap;
    }

    input {
      width: 200px;
      padding: 5px 8px;
      font-size: 14px;
      box-sizing: border-box;
    }

    #buttonGroup {
      margin: 10px 0 15px 0;
      text-align: center;
    }

    button {
      padding: 8px 20px;
      margin: 0 10px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      border: none;
      border-radius: 4px;
      background-color: #6C6C6C;
      color: white;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #005A9E;
    }

    button.magnetic {
      transition: transform 0.2s ease;
      position: relative;
      z-index: 1;
    }

    #outputWrapper {
      display: flex;
      gap: 20px;
      justify-content: center;
    }

    textarea {
      width: 250px;
      height: 250px;
      font-family: "å¾®è»Ÿæ­£é»‘é«”";
      font-size: 11pt;
      font-weight: bold;
      white-space: pre-wrap;
      resize: vertical;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    #htmlContent {
      display: none;
    }

    #footerNote {
      position: fixed;
      bottom: 8px;
      right: 10px;
      font-size: 7px;
      font-weight: bold;
      color: #3C3C3C;
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
    }
  </style>
</head>
<body>

<div id="container">
  <h2>ç§Ÿé‡‘è©¦ç®—è¡¨å–®</h2>

  <form id="rentForm" onsubmit="event.preventDefault(); generateTemplate();">
    <div class="form-row">
      <label for="year">é–‹æ’­å¹´ï¼ˆè¥¿å…ƒï¼‰ï¼š</label>
      <input type="number" id="year" min="1900" max="2100" />
    </div>

    <div class="form-row">
      <label for="month">é–‹æ’­æœˆï¼š</label>
      <input type="number" id="month" min="1" max="12" />
    </div>

    <div class="form-row">
      <label for="day">é–‹æ’­æ—¥ï¼š</label>
      <input type="number" id="day" min="1" max="31" />
    </div>

    <div class="form-row">
      <label for="rent">å–®å°ç§Ÿé‡‘ï¼š</label>
      <input type="number" id="rent" min="0" step="0.01" />
    </div>

    <div class="form-row">
      <label for="units">å°æ•¸ï¼š</label>
      <input type="number" id="units" min="1" />
    </div>
  </form>

  <div id="buttonGroup">
    <button id="calcBtn" onclick="generateTemplate()">è¨ˆç®—</button>
    <button id="copyBtn" onclick="copyHTML()">ğŸ“‹ è¤‡è£½</button>
    <button onclick="clearAll()">æ¸…é™¤</button>
  </div>

  <div id="outputWrapper">
    <div>
      <h3>ğŸ“ è¨ˆç®—å…¬å¼çµæœï¼š</h3>
      <textarea id="calcResult" readonly></textarea>
    </div>
    <div>
      <h3>ğŸ“ éƒµä»¶å…§å®¹ç”¢å‡ºï¼š</h3>
      <textarea id="emailBody" readonly></textarea>
    </div>
  </div>
  <div id="htmlContent"></div>
</div>
<div id="footerNote">20250520 #SummerChung</div>

<script>
function daysInMonth(year, month) {
  return new Date(year, month, 0).getDate();
}

function isValidInputs() {
  return ["year", "month", "day", "rent", "units"].every(id => {
    const value = document.getElementById(id).value;
    return value !== "" && value !== null;
  });
}

function checkMonthAndDay(year, month, day) {
  if (month < 1 || month > 12) {
    alert("é–‹æ’­æœˆè«‹è¼¸å…¥ 1 åˆ° 12 ä¹‹é–“çš„æ•¸å­—");
    return false;
  }
  const daysTotal = daysInMonth(year, month);
  if (day < 1 || day > daysTotal) {
    alert(`è©²æœˆåªæœ‰ ${daysTotal} å¤©ï¼Œè«‹ä¿®æ­£ã€Œé–‹æ’­æ—¥ã€`);
    return false;
  }
  return true;
}

function calculateFormula() {
  const year = parseInt(document.getElementById('year').value);
  const month = parseInt(document.getElementById('month').value);
  const day = parseInt(document.getElementById('day').value);
  const rent = parseFloat(document.getElementById('rent').value);
  const units = parseInt(document.getElementById('units').value);

  if (!isValidInputs()) return null;

  if (!checkMonthAndDay(year, month, day)) return null;

  const daysTotal = daysInMonth(year, month);

  const playDays = daysTotal - day + 1;
  const total = Math.round(rent / daysTotal * playDays * units);
  const formula = `${rent} / ${daysTotal} * ${playDays} * ${units} = $${total}`;

  document.getElementById("calcResult").value = formula;
  return { formula, year, month, day, rent, units };
}

function generateTemplate() {
  const result = calculateFormula();
  if (!result) return;

  const { formula, year, month, day, rent, units } = result;
  const rocYear = year - 1911;
  const dateStr = `${rocYear}/${String(month).padStart(2, '0')}/${String(day).padStart(2, '0')}`;

  const plainText = `Dear Allï¼š\n\nå¤§æ¨“åç¨±ï¼š\nåœ°å€ï¼š\nåˆç´„æœŸé–“ï¼š\næ›æ©Ÿé–‹æ’­æ—¥æœŸï¼š${dateStr}\nå–®å°ç§Ÿé‡‘ï¼š${rent}\nå¯¦éš›æ›æ©Ÿå°æ•¸ï¼š${units}\nå‚™è¨»ï¼š${formula}`;

  const htmlTemplate = `
    <div style="font-family: 'å¾®è»Ÿæ­£é»‘é«”'; font-size: 11pt; font-weight: bold; line-height: 1.6;">
      Dear Allï¼š<br><br>
      å¤§æ¨“åç¨±ï¼š<br>
      åœ°å€ï¼š<br>
      åˆç´„æœŸé–“ï¼š<br>
      æ›æ©Ÿé–‹æ’­æ—¥æœŸï¼š${dateStr}<br>
      å–®å°ç§Ÿé‡‘ï¼š${rent}<br>
      å¯¦éš›æ›æ©Ÿå°æ•¸ï¼š${units}<br>
      å‚™è¨»ï¼š${formula}
    </div>
  `;

  document.getElementById("emailBody").value = plainText;
  document.getElementById("htmlContent").innerHTML = htmlTemplate;
}

function copyHTML() {
  const html = document.getElementById("htmlContent").innerHTML;
  if (!html) {
    alert("è«‹å…ˆç”¢ç”Ÿä¿¡ä»¶å…§å®¹");
    return;
  }

  const blob = new Blob([html], { type: "text/html" });
  const data = [new ClipboardItem({ "text/html": blob })];

  navigator.clipboard.write(data).then(() => {
    alert("HTML å…§å®¹å·²è¤‡è£½ï¼Œè«‹è²¼åˆ° Outlook ä¸­ä½¿ç”¨ï¼");
  }).catch(() => {
    alert("è¤‡è£½å¤±æ•—ï¼Œè«‹ä½¿ç”¨æ”¯æ´ clipboard çš„ç€è¦½å™¨");
  });
}

function clearAll() {
  ['year','month','day','rent','units'].forEach(id => document.getElementById(id).value = "");
  document.getElementById("calcResult").value = "";
  document.getElementById("emailBody").value = "";
  document.getElementById("htmlContent").innerHTML = "";
}

// ç›£è½æ¬„ä½è‡ªå‹•æ›´æ–°çµæœ
['year', 'month', 'day', 'rent', 'units'].forEach(id => {
  document.getElementById(id).addEventListener("input", generateTemplate);
});

// æ’æ–¥æ•ˆæœ

document.addEventListener("mousemove", function(e) {
  const calcBtn = document.getElementById("calcBtn");
  const copyBtn = document.getElementById("copyBtn");
  const buttons = [calcBtn, copyBtn];

  if (!isValidInputs()) {
    buttons.forEach(button => {
      const rect = button.getBoundingClientRect();
      const mouseX = e.clientX;
      const mouseY = e.clientY;
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const dx = centerX - mouseX;
      const dy = centerY - mouseY;
      const distance = Math.sqrt(dx * dx + dy * dy);

      const repelRadius = 140;
      if (distance < repelRadius) {
        const angle = Math.atan2(dy, dx);
        const offsetX = Math.cos(angle) * (repelRadius - distance);
        const offsetY = Math.sin(angle) * (repelRadius - distance);
        button.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
        button.classList.add("magnetic");
      } else {
        button.style.transform = "translate(0, 0)";
        button.classList.remove("magnetic");
      }
    });
  } else {
    buttons.forEach(button => {
      button.style.transform = "translate(0, 0)";
      button.classList.remove("magnetic");
    });
  }
});
</script>
</body>
</html>
